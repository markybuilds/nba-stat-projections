<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NBA Stat Projections - PWA Tester</title>
  <style>
    :root {
      --primary: #0f172a;
      --primary-light: #1e293b;
      --accent: #60a5fa;
      --text: #f8fafc;
      --text-muted: #94a3b8;
      --bg: #0f172a;
      --bg-light: #1e293b;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --border: #334155;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    
    header {
      margin-bottom: 2rem;
      text-align: center;
    }
    
    h1 {
      margin-bottom: 0.5rem;
      color: var(--accent);
    }
    
    p {
      color: var(--text-muted);
    }
    
    .card {
      background-color: var(--bg-light);
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
    }
    
    h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }
    
    h2 .icon {
      margin-right: 0.5rem;
      font-size: 1.4rem;
    }
    
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    
    .test-card {
      background-color: var(--primary-light);
      border-radius: 0.5rem;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }
    
    .test-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .test-description {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
      flex-grow: 1;
    }
    
    .button {
      display: inline-block;
      background-color: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: 0.25rem;
      padding: 0.5rem 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
      text-align: center;
    }
    
    .button:hover {
      background-color: #3b82f6;
    }
    
    .button.secondary {
      background-color: var(--bg-light);
      color: var(--text);
      border: 1px solid var(--border);
    }
    
    .button.secondary:hover {
      background-color: var(--primary-light);
    }
    
    .button.full-width {
      width: 100%;
    }
    
    .results {
      margin-top: 2rem;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 0.875rem;
      background-color: var(--primary-light);
      padding: 1rem;
      border-radius: 0.25rem;
      max-height: 300px;
      overflow: auto;
    }
    
    .status {
      display: flex;
      margin-top: 1rem;
      padding: 1rem;
      background-color: var(--primary-light);
      border-radius: 0.25rem;
      align-items: center;
    }
    
    .status-icon {
      font-size: 1.5rem;
      margin-right: 1rem;
    }
    
    .status-text {
      flex-grow: 1;
    }
    
    .status.success {
      background-color: rgba(16, 185, 129, 0.1);
      border: 1px solid var(--success);
    }
    
    .status.warning {
      background-color: rgba(245, 158, 11, 0.1);
      border: 1px solid var(--warning);
    }
    
    .status.error {
      background-color: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--error);
    }
    
    .success-icon { color: var(--success); }
    .warning-icon { color: var(--warning); }
    .error-icon { color: var(--error); }
    
    .hidden {
      display: none;
    }
    
    #network-simulator {
      margin-top: 1rem;
      padding: 1rem;
      background-color: var(--primary-light);
      border-radius: 0.25rem;
      text-align: center;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
      margin: 0 10px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #64748b;
      transition: .4s;
      border-radius: 34px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--success);
    }
    
    input:focus + .slider {
      box-shadow: 0 0 1px var(--success);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    @media (max-width: 640px) {
      .test-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>NBA Stat Projections - PWA Tester</h1>
      <p>A tool to verify Progressive Web App functionality</p>
    </header>
    
    <div class="card">
      <h2><span class="icon">üîç</span> Test Suite</h2>
      <p>Run tests to verify PWA implementation</p>
      
      <div class="test-grid">
        <div class="test-card">
          <div class="test-name">Service Worker Status</div>
          <div class="test-description">Check if the service worker is properly registered and active</div>
          <button class="button full-width" id="test-sw">Run Test</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Cache Inspection</div>
          <div class="test-description">View the cache contents to verify proper caching</div>
          <button class="button full-width" id="test-cache">Inspect Cache</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Offline Capability</div>
          <div class="test-description">Test if the app works properly when offline</div>
          <button class="button full-width" id="test-offline">Test Offline</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Network Detection</div>
          <div class="test-description">Verify the app can detect network status changes</div>
          <button class="button full-width" id="test-network">Test Network Detection</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Install Prompt</div>
          <div class="test-description">Check if the app can be installed</div>
          <button class="button full-width" id="test-install">Check Install Status</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Full Test Suite</div>
          <div class="test-description">Run all tests and get a comprehensive report</div>
          <button class="button full-width" id="test-all">Run All Tests</button>
        </div>
      </div>
      
      <div id="network-simulator" class="hidden">
        <p>Network Status Simulator</p>
        <span>Offline</span>
        <label class="toggle-switch">
          <input type="checkbox" id="network-toggle" checked>
          <span class="slider"></span>
        </label>
        <span>Online</span>
      </div>
      
      <div id="status" class="status hidden">
        <div class="status-icon" id="status-icon">‚ÑπÔ∏è</div>
        <div class="status-text" id="status-text">Running tests...</div>
      </div>
      
      <pre id="results" class="results hidden"></pre>
    </div>
    
    <div class="card">
      <h2><span class="icon">üì±</span> PWA Installation</h2>
      <p>Test the installation process on your device</p>
      
      <div class="test-grid">
        <div class="test-card">
          <div class="test-name">Trigger Install</div>
          <div class="test-description">Try to trigger the install prompt (if available)</div>
          <button class="button full-width" id="trigger-install">Install App</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Check Installed Status</div>
          <div class="test-description">Check if the app is already installed</div>
          <button class="button full-width" id="check-installed">Check Status</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">View Manifest</div>
          <div class="test-description">Check the web app manifest</div>
          <button class="button full-width" id="view-manifest">View Manifest</button>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2><span class="icon">üîÑ</span> Service Worker Management</h2>
      <p>Manage the service worker lifecycle</p>
      
      <div class="test-grid">
        <div class="test-card">
          <div class="test-name">Check for Updates</div>
          <div class="test-description">Check if there is a new version of the service worker</div>
          <button class="button full-width" id="check-updates">Check Updates</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Unregister Service Worker</div>
          <div class="test-description">Unregister the current service worker (for testing)</div>
          <button class="button full-width" id="unregister-sw">Unregister</button>
        </div>
        
        <div class="test-card">
          <div class="test-name">Clear Caches</div>
          <div class="test-description">Clear all caches created by the service worker</div>
          <button class="button full-width" id="clear-caches">Clear Caches</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/scripts/test-pwa.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize the UI
      const resultsEl = document.getElementById('results');
      const statusEl = document.getElementById('status');
      const statusIconEl = document.getElementById('status-icon');
      const statusTextEl = document.getElementById('status-text');
      const networkSimulator = document.getElementById('network-simulator');
      const networkToggle = document.getElementById('network-toggle');
      
      // Helper to show results
      function showResults(data, success = true, message = '') {
        resultsEl.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
        resultsEl.classList.remove('hidden');
        
        if (message) {
          statusEl.className = 'status ' + (success ? 'success' : 'error');
          statusIconEl.textContent = success ? '‚úÖ' : '‚ùå';
          statusIconEl.className = 'status-icon ' + (success ? 'success-icon' : 'error-icon');
          statusTextEl.textContent = message;
          statusEl.classList.remove('hidden');
        } else {
          statusEl.classList.add('hidden');
        }
      }
      
      // Service Worker Test
      document.getElementById('test-sw').addEventListener('click', async function() {
        try {
          const result = await PWATest.checkServiceWorker();
          const success = result.registered;
          showResults(result, success, success 
            ? `Service worker registered with scope: ${result.scope}` 
            : 'Service worker not registered');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error testing service worker');
        }
      });
      
      // Cache Test
      document.getElementById('test-cache').addEventListener('click', async function() {
        try {
          const result = await PWATest.inspectCaches();
          const success = result.available;
          
          let message = '';
          if (success && result.caches) {
            const cacheCount = Object.keys(result.caches).length;
            message = `Found ${cacheCount} cache(s)`;
          } else {
            message = 'Cache API not available or no caches found';
          }
          
          showResults(result, success, message);
        } catch (error) {
          showResults({ error: error.message }, false, 'Error inspecting caches');
        }
      });
      
      // Offline Test
      document.getElementById('test-offline').addEventListener('click', async function() {
        try {
          networkSimulator.classList.remove('hidden');
          
          const homeResult = await PWATest.testOfflineFetch(window.location.origin + '/');
          const apiResult = await PWATest.testOfflineFetch(window.location.origin + '/api/players');
          
          const result = {
            home: homeResult,
            api: apiResult
          };
          
          const success = homeResult.cached;
          showResults(result, success, success 
            ? 'Home page is cached and can be accessed offline' 
            : 'Home page is not properly cached for offline use');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error testing offline capability');
        }
      });
      
      // Network Detection Test
      document.getElementById('test-network').addEventListener('click', async function() {
        networkSimulator.classList.remove('hidden');
        statusEl.className = 'status warning';
        statusIconEl.textContent = '‚ö†Ô∏è';
        statusIconEl.className = 'status-icon warning-icon';
        statusTextEl.textContent = 'Please toggle the network switch to test detection...';
        statusEl.classList.remove('hidden');
        
        try {
          // We'll use a simplified test here since the full test requires user toggling network
          const result = {
            navigatorOnline: navigator.onLine,
            listener: 'To test event listeners, toggle the network switch below'
          };
          
          showResults(result, true, 'Current network status detected');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error testing network detection');
        }
      });
      
      // Network Toggle Switch
      networkToggle.addEventListener('change', function() {
        if (this.checked) {
          statusEl.className = 'status success';
          statusIconEl.textContent = '‚úÖ';
          statusIconEl.className = 'status-icon success-icon';
          statusTextEl.textContent = 'Online mode detected';
        } else {
          statusEl.className = 'status warning';
          statusIconEl.textContent = '‚ö†Ô∏è';
          statusIconEl.className = 'status-icon warning-icon';
          statusTextEl.textContent = 'Offline mode detected';
        }
      });
      
      // Install Prompt Test
      document.getElementById('test-install').addEventListener('click', function() {
        try {
          const result = PWATest.checkInstallPrompt();
          const promptAvailable = !!window.deferredPrompt;
          
          showResults(result, true, promptAvailable 
            ? 'Install prompt is available and can be triggered' 
            : 'Install prompt not available (app may already be installed or recently dismissed)');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error checking install prompt');
        }
      });
      
      // Full Test Suite
      document.getElementById('test-all').addEventListener('click', async function() {
        try {
          statusEl.className = 'status';
          statusIconEl.textContent = '‚è≥';
          statusTextEl.textContent = 'Running all tests, please wait...';
          statusEl.classList.remove('hidden');
          
          const result = await PWATest.runFullTest();
          
          const serviceWorkerOk = result.serviceWorker.registered;
          const cacheOk = result.caches.available;
          const offlineOk = result.offlineCapability.home.cached;
          
          const allOk = serviceWorkerOk && cacheOk && offlineOk;
          
          showResults(result, allOk, allOk 
            ? 'All PWA functionality is working correctly!' 
            : 'Some PWA features are not working properly. See details below.');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error running test suite');
        }
      });
      
      // Trigger Install
      document.getElementById('trigger-install').addEventListener('click', async function() {
        try {
          if (!window.deferredPrompt) {
            showResults({ status: 'no_prompt' }, false, 
              'No install prompt available. The app may already be installed or the prompt was recently dismissed.');
            return;
          }
          
          // Show the prompt
          window.deferredPrompt.prompt();
          
          // Wait for the user to respond to the prompt
          const choiceResult = await window.deferredPrompt.userChoice;
          
          const accepted = choiceResult.outcome === 'accepted';
          showResults({ outcome: choiceResult.outcome }, accepted, 
            accepted ? 'Installation accepted!' : 'Installation declined by user');
          
          // Clear the prompt
          window.deferredPrompt = null;
        } catch (error) {
          showResults({ error: error.message }, false, 'Error triggering install prompt');
        }
      });
      
      // Check Installed Status
      document.getElementById('check-installed').addEventListener('click', async function() {
        try {
          let installed = false;
          
          // Method 1: Check using window.matchMedia
          if (window.matchMedia('(display-mode: standalone)').matches) {
            installed = true;
          }
          
          // Method 2: Check using navigator.standalone (iOS)
          if (navigator.standalone) {
            installed = true;
          }
          
          const result = {
            installed,
            matchMediaStandalone: window.matchMedia('(display-mode: standalone)').matches,
            navigatorStandalone: !!navigator.standalone,
            installPromptAvailable: !!window.deferredPrompt
          };
          
          showResults(result, true, installed 
            ? 'App is installed and running in standalone mode' 
            : 'App is running in browser mode (not installed)');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error checking installed status');
        }
      });
      
      // View Manifest
      document.getElementById('view-manifest').addEventListener('click', async function() {
        try {
          const manifestLink = document.querySelector('link[rel="manifest"]');
          
          if (!manifestLink) {
            showResults({ error: 'No manifest link found in document' }, false, 'Manifest link not found');
            return;
          }
          
          const response = await fetch(manifestLink.href);
          if (!response.ok) {
            throw new Error(`Failed to fetch manifest: ${response.status} ${response.statusText}`);
          }
          
          const manifest = await response.json();
          showResults(manifest, true, 'Web App Manifest successfully retrieved');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error fetching manifest');
        }
      });
      
      // Check for Updates
      document.getElementById('check-updates').addEventListener('click', async function() {
        try {
          const result = await PWATest.checkForUpdates();
          
          showResults(result, result.success, result.success 
            ? (result.waiting ? 'Update available and waiting to be activated' : 'No updates available')
            : 'Error checking for updates');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error checking for updates');
        }
      });
      
      // Unregister Service Worker
      document.getElementById('unregister-sw').addEventListener('click', async function() {
        try {
          if (!('serviceWorker' in navigator)) {
            showResults({ error: 'Service Worker API not available' }, false, 'Service Worker API not supported');
            return;
          }
          
          const registration = await navigator.serviceWorker.getRegistration();
          if (!registration) {
            showResults({ error: 'No service worker registered' }, false, 'No service worker registered');
            return;
          }
          
          const success = await registration.unregister();
          showResults({ unregistered: success }, success, success 
            ? 'Service worker successfully unregistered' 
            : 'Failed to unregister service worker');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error unregistering service worker');
        }
      });
      
      // Clear Caches
      document.getElementById('clear-caches').addEventListener('click', async function() {
        try {
          if (!('caches' in window)) {
            showResults({ error: 'Cache API not available' }, false, 'Cache API not supported');
            return;
          }
          
          const cacheNames = await caches.keys();
          const deletePromises = cacheNames.map(name => caches.delete(name));
          await Promise.all(deletePromises);
          
          showResults({ cleared: cacheNames }, true, 
            cacheNames.length > 0 ? `Successfully cleared ${cacheNames.length} cache(s)` : 'No caches to clear');
        } catch (error) {
          showResults({ error: error.message }, false, 'Error clearing caches');
        }
      });
    });
  </script>
</body>
</html> 